---
import { graphQLClient, gql } from '../lib/graphql';

const GET_POSTS = gql`
  query GetPosts {
    posts {
      nodes {
        title
        uri
      }
    }
  }
`;

let posts = [];
try {
  const data = await graphQLClient.request(GET_POSTS);
  posts = data.posts.nodes;
} catch (error) {
  console.error("Error fetching posts:", error);
}
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Mindlooker - Blog</title>
	</head>
	<body>
		<h1>Welcome to Mindlooker Blog</h1>

		{posts.length > 0 ? (
			<ul>
				{posts.map((post) => (
					<li>
						<a href={post.uri}>{post.title}</a>
					</li>
				))}
			</ul>
		) : (
			<p>No posts found. Please add some posts in your WordPress CMS.</p>
		)}
	</body>
</html>