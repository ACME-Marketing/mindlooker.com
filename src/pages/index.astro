---
import { graphQLClient, gql } from '../lib/graphql';

const site = "mindlooker.com";

// Get posts for this site
const GET_POSTS = gql`query GetPosts($siteTags: [String]) {
  posts(where: { tagSlugIn: $siteTags }) {
    nodes {
      title
      uri
      content
      featuredImage {
        node {
          sourceUrl
          altText
          mediaDetails {
            width
            height
          }
        }
      }
      tags {
        nodes {
          name
          slug
        }
      }
    }
  }
}
`; // Added closing backtick

let posts = [];
try {
  const data = await graphQLClient.request(GET_POSTS, {
    siteTags: [site, "all"]
  });
  posts = data.posts.nodes;
} catch (error) {
  console.error("Error fetching posts:", error);
}
---

<BaseLayout title={site}>
  <main class="container mx-auto px-4 py-12">
    <h2 class="text-4xl font-bold text-center mb-10 text-gray-800">Latest Insights</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
      {posts.map(post => (
        <div class="bg-white rounded-xl shadow-xl overflow-hidden transform hover:scale-105 transition duration-300 flex flex-col" key={post.uri}>
          {post.featuredImage?.node &&
            <img src={post.featuredImage.node.sourceUrl} alt={post.featuredImage.node.altText} class="w-full h-56 object-cover" />
          }
          <div class="p-7 flex flex-col flex-grow">
            <h3 class="text-2xl font-semibold mb-3 leading-tight">
              <a href={post.uri} class="text-gray-900 hover:text-blue-600 transition duration-300">{post.title}</a>
            </h3>
            <p class="text-gray-600 text-sm mb-4">
              Tags: {post.tags.nodes.map(tag => tag.name).join(', ')}
            </p>
            <div class="text-gray-700 text-base mb-5 flex-grow">
              {post.content}
            </div>
            <a href={post.uri} class="mt-auto inline-block bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition duration-300 text-center">Read More</a>
          </div>
        </div>
      ))}
    </div>
  </main>
</BaseLayout>
